{% extends 'salon/base.html' %}

{% block title %}Manage Appointments | ChautariChic{% endblock %}

{% block content %}
<div class="container" style="max-width: 1100px; padding: 2.5rem 1rem;">
    <div style="margin-bottom: 2rem; display: flex; justify-content: space-between; align-items: flex-end;">
        <div>
            <h1 style="font-family: var(--font-heading); font-size: 2rem; color: var(--dark); margin-bottom: 0.5rem;">
                Salon Appointments</h1>
            <p style="color: #64748b; font-size: 0.95rem;">Manage your bookings and keep your schedule up to date.</p>
        </div>
        <div
            style="background: #e0f2fe; color: #0369a1; padding: 6px 12px; border-radius: 8px; font-weight: 600; font-size: 0.85rem;">
            Total: {{ appointments.count }}
        </div>
    </div>

    <div
        style="background: white; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); border: 1px solid #e2e8f0; overflow: hidden;">
        <div style="overflow-x: auto;">
            <table style="width: 100%; border-collapse: collapse; min-width: 800px;">
                <thead>
                    <tr style="text-align: left; background: #f8fafc; border-bottom: 1px solid #e2e8f0;">
                        <th
                            style="padding: 1rem; font-weight: 600; color: #475569; font-size: 0.85rem; text-transform: uppercase;">
                            Customer</th>
                        <th
                            style="padding: 1rem; font-weight: 600; color: #475569; font-size: 0.85rem; text-transform: uppercase;">
                            Service</th>
                        <th
                            style="padding: 1rem; font-weight: 600; color: #475569; font-size: 0.85rem; text-transform: uppercase;">
                            Date & Time</th>
                        <th
                            style="padding: 1rem; font-weight: 600; color: #475569; font-size: 0.85rem; text-transform: uppercase;">
                            Status</th>
                        <th
                            style="padding: 1rem; font-weight: 600; color: #475569; font-size: 0.85rem; text-transform: uppercase; text-align: right;">
                            Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for appt in appointments %}
                    <tr style="border-bottom: 1px solid #f1f5f9; transition: background 0.1s;">
                        <td style="padding: 1rem;">
                            <div style="font-weight: 600; color: var(--dark);">{{ appt.customer.get_full_name }}</div>
                            <div style="font-size: 0.8rem; color: #94a3b8;">{{ appt.customer.email }}</div>
                        </td>
                        <td style="padding: 1rem;">
                            <div style="color: var(--dark);">{{ appt.service.name }}</div>
                            {% if appt.staff %}
                            <div style="font-size: 0.8rem; color: var(--primary); margin-top: 2px;">
                                <i class="fas fa-user-tag" style="font-size: 0.7rem;"></i> {{ appt.staff.name }}
                            </div>
                            {% endif %}
                        </td>
                        <td style="padding: 1rem;">
                            <div style="font-weight: 500; color: #334155;">{{ appt.date }}</div>
                            <div style="font-size: 0.8rem; color: #64748b;">{{ appt.time }}</div>
                        </td>
                        <td style="padding: 1rem;">
                            <span style="font-size: 0.75rem; font-weight: 700; padding: 4px 10px; border-radius: 99px; text-transform: uppercase;
                            {% if appt.status == 'PENDING' %} background: #fff7ed; color: #c2410c;
                            {% elif appt.status == 'CONFIRMED' %} background: #ecfdf5; color: #047857;
                            {% elif appt.status == 'CANCELLED' %} background: #fef2f2; color: #b91c1c;
                            {% else %} background: #eff6ff; color: #1d4ed8; {% endif %}">
                                {{ appt.status }}
                            </span>
                        </td>
                        <td style="padding: 1rem; text-align: right;">
                            <div style="display: flex; gap: 8px; justify-content: flex-end;">
                                {% if appt.status == 'PENDING' %}
                                <form action="{% url 'booking:update_status' appt.pk 'CONFIRMED' %}" method="post">
                                    {% csrf_token %}
                                    <button type="submit" class="btn"
                                        style="padding: 6px 12px; font-size: 0.8rem; background: #d1fae5; color: #065f46; border: 1px solid #a7f3d0; border-radius: 6px; cursor: pointer;">
                                        <i class="fas fa-check"></i> Confirm
                                    </button>
                                </form>
                                {% endif %}

                                {% if appt.status == 'CONFIRMED' %}
                                <form action="{% url 'booking:update_status' appt.pk 'COMPLETED' %}" method="post">
                                    {% csrf_token %}
                                    <button type="submit" class="btn"
                                        style="padding: 6px 12px; font-size: 0.8rem; background: #dbeafe; color: #1e40af; border: 1px solid #bfdbfe; border-radius: 6px; cursor: pointer;">
                                        <i class="fas fa-check-double"></i> Complete
                                    </button>
                                </form>
                                {% endif %}

                                {% if appt.status != 'CANCELLED' and appt.status != 'COMPLETED' %}
                                <form action="{% url 'booking:update_status' appt.pk 'CANCELLED' %}" method="post">
                                    {% csrf_token %}
                                    <button type="submit" class="btn"
                                        style="padding: 6px 12px; font-size: 0.8rem; background: white; color: #ef4444; border: 1px solid #fca5a5; border-radius: 6px; cursor: pointer; transition: background 0.2s;">
                                        <i class="fas fa-times"></i> Cancel
                                    </button>
                                </form>
                                {% endif %}
                            </div>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="5" style="padding: 4rem; text-align: center; color: #94a3b8;">
                            <i class="far fa-calendar-times"
                                style="font-size: 2.5rem; margin-bottom: 1rem; opacity: 0.5;"></i>
                            <p>No appointments found.</p>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}